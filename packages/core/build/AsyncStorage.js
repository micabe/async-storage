"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defaults = require("./defaults");

var _extension = require("./extension");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class AsyncStorage {
  constructor(storageBackend, asOptions) {
    _defineProperty(this, "ext", void 0);

    _defineProperty(this, "_backend", void 0);

    _defineProperty(this, "_config", void 0);

    _defineProperty(this, "log", void 0);

    _defineProperty(this, "error", void 0);

    this._backend = storageBackend;
    this._config = asOptions; // off by default

    this.log = _defaults.noop;
    this.error = _defaults.noop;
    this.ext = (0, _extension.createExtension)(this._backend);

    if (this._config.logger) {
      this.log = typeof this._config.logger === 'function' ? this._config.logger : _defaults.simpleLogger;
    }

    if (this._config.errorHandler) {
      this.error = typeof this._config.errorHandler === 'function' ? this._config.errorHandler : _defaults.simpleErrorHandler;
    }
  }

  async getItem(key, opts = null) {
    let value = null;

    try {
      this.log({
        action: 'read-single',
        key: key
      });
      value = await this._backend.getSingle(key, opts);
    } catch (e) {
      this.error(e);
    }

    return value;
  }

  async setItem(key, value, opts = null) {
    try {
      this.log({
        action: 'save-single',
        key: key,
        value
      });
      await this._backend.setSingle(key, value, opts);
    } catch (e) {
      this.error(e);
    }
  }

  async getMultiple(keys, opts = null) {
    let values = {};

    try {
      this.log({
        action: 'read-many',
        key: keys
      });
      values = await this._backend.getMany(keys, opts);
    } catch (e) {
      this.error(e);
    }

    return values;
  }

  async setMultiple(keyValues, opts = null) {
    try {
      this.log({
        action: 'save-many',
        value: keyValues
      });
      await this._backend.setMany(keyValues, opts);
    } catch (e) {
      this.error(e);
    }
  }

  async remove(key, opts = null) {
    try {
      this.log({
        action: 'delete-single',
        key: key
      });
      await this._backend.removeSingle(key, opts);
    } catch (e) {
      this.error(e);
    }
  }

  async removeMultiple(keys, opts = null) {
    try {
      this.log({
        action: 'delete-many',
        key: keys
      });
      await this._backend.removeMany(keys, opts);
    } catch (e) {
      this.error(e);
    }
  }

  async getKeys(opts = null) {
    let keys = [];

    try {
      this.log({
        action: 'keys'
      });
      keys = await this._backend.getKeys(opts);
    } catch (e) {
      this.error(e);
    }

    return keys;
  }

  async clearStorage(opts = null) {
    try {
      this.log({
        action: 'drop'
      });
      await this._backend.dropStorage(opts);
    } catch (e) {
      this.error(e);
    }
  }

}

var _default = AsyncStorage;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Bc3luY1N0b3JhZ2UudHMiXSwibmFtZXMiOlsiQXN5bmNTdG9yYWdlIiwiY29uc3RydWN0b3IiLCJzdG9yYWdlQmFja2VuZCIsImFzT3B0aW9ucyIsIl9iYWNrZW5kIiwiX2NvbmZpZyIsImxvZyIsIm5vb3AiLCJlcnJvciIsImV4dCIsImxvZ2dlciIsInNpbXBsZUxvZ2dlciIsImVycm9ySGFuZGxlciIsInNpbXBsZUVycm9ySGFuZGxlciIsImdldEl0ZW0iLCJrZXkiLCJvcHRzIiwidmFsdWUiLCJhY3Rpb24iLCJnZXRTaW5nbGUiLCJlIiwic2V0SXRlbSIsInNldFNpbmdsZSIsImdldE11bHRpcGxlIiwia2V5cyIsInZhbHVlcyIsImdldE1hbnkiLCJzZXRNdWx0aXBsZSIsImtleVZhbHVlcyIsInNldE1hbnkiLCJyZW1vdmUiLCJyZW1vdmVTaW5nbGUiLCJyZW1vdmVNdWx0aXBsZSIsInJlbW92ZU1hbnkiLCJnZXRLZXlzIiwiY2xlYXJTdG9yYWdlIiwiZHJvcFN0b3JhZ2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFRQTs7QUFDQTs7OztBQVNBLE1BQU1BLFlBQU4sQ0FBb0Q7QUFRbERDLEVBQUFBLFdBQVcsQ0FBQ0MsY0FBRCxFQUFvQkMsU0FBcEIsRUFBK0M7QUFBQTs7QUFBQTs7QUFBQTs7QUFBQTs7QUFBQTs7QUFDeEQsU0FBS0MsUUFBTCxHQUFnQkYsY0FBaEI7QUFDQSxTQUFLRyxPQUFMLEdBQWVGLFNBQWYsQ0FGd0QsQ0FJeEQ7O0FBQ0EsU0FBS0csR0FBTCxHQUFXQyxjQUFYO0FBQ0EsU0FBS0MsS0FBTCxHQUFhRCxjQUFiO0FBRUEsU0FBS0UsR0FBTCxHQUFXLGdDQUFtQixLQUFLTCxRQUF4QixDQUFYOztBQUVBLFFBQUksS0FBS0MsT0FBTCxDQUFhSyxNQUFqQixFQUF5QjtBQUN2QixXQUFLSixHQUFMLEdBQ0UsT0FBTyxLQUFLRCxPQUFMLENBQWFLLE1BQXBCLEtBQStCLFVBQS9CLEdBQ0ksS0FBS0wsT0FBTCxDQUFhSyxN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O0FBQ2YsUUFBSTtBQUNGLFdBQUtWLEdBQUwsQ0FBUztBQUNQWSxRQUFBQSxNQUFNLEVBQUUsYUFERDtBQUVQSCxRQUFBQSxHQUFHLEVBQUVTO0FBRkUsT0FBVDtBQUlBLFlBQU0sS0FBS3BCLFFBQUwsQ0FBYzZCLFVBQWQsQ0FBeUJULElBQXpCLEVBQStCUixJQUEvQixDQUFOO0FBQ0QsS0FORCxDQU1FLE9BQU9JLENBQVAsRUFBVTtBQUNWLFdBQUtaLEtBQUwsQ0FBV1ksQ0FBWDtBQUNEO0FBQ0Y7O0FBRUQsUUFBTWMsT0FBTixDQUFjbEIsSUFBb0IsR0FBRyxJQUFyQyxFQUFvRTtBQUNsRSxRQUFJUSxJQUFvQixHQUFHLEVBQTNCOztBQUVBLFFBQUk7QUFDRixXQUFLbEIsR0FBTCxDQUFTO0FBQ1BZLFFBQUFBLE1BQU0sRUFBRTtBQURELE9BQVQ7QUFHQU0sTUFBQUEsSUFBSSxHQUFHLE1BQU0sS0FBS3BCLFFBQUwsQ0FBYzhCLE9BQWQsQ0FBc0JsQixJQUF0QixDQUFiO0FBQ0QsS0FMRCxDQUtFLE9BQU9JLENBQVAsRUFBVTtBQUNWLFdBQUtaLEtBQUwsQ0FBV1ksQ0FBWDtBQUNEOztBQUVELFdBQU9JLElBQVA7QUFDRDs7QUFFRCxRQUFNVyxZQUFOLENBQW1CbkIsSUFBb0IsR0FBRyxJQUExQyxFQUErRDtBQUM3RCxRQUFJO0FBQ0YsV0FBS1YsR0FBTCxDQUFTO0FBQ1BZLFFBQUFBLE1BQU0sRUFBRTtBQURELE9BQVQ7QUFHQSxZQUFNLEtBQUtkLFFBQUwsQ0FBY2dDLFdBQWQsQ0FBMEJwQixJQUExQixDQUFOO0FBQ0QsS0FMRCxDQUtFLE9BQU9JLENBQVAsRUFBVTtBQUNWLFdBQUtaLEtBQUwsQ0FBV1ksQ0FBWDtBQUNEO0FBQ0Y7O0FBeEppRDs7ZUEySnJDcEIsWSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBSZWFjdCBOYXRpdmUgQ29tbXVuaXR5LlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqL1xuXG5pbXBvcnQge3NpbXBsZUVycm9ySGFuZGxlciwgc2ltcGxlTG9nZ2VyLCBub29wfSBmcm9tICcuL2RlZmF1bHRzJztcbmltcG9ydCB7Y3JlYXRlRXh0ZW5zaW9ufSBmcm9tICcuL2V4dGVuc2lvbic7XG5pbXBvcnQge1xuICBFeHRlbnNpb25UeXBlLFxuICBGYWN0b3J5T3B0aW9ucyxcbiAgSVN0b3JhZ2VCYWNrZW5kLFxuICBMb2dnZXJBY3Rpb24sXG4gIFN0b3JhZ2VPcHRpb25zLFxufSBmcm9tICcuLi90eXBlcyc7XG5cbmNsYXNzIEFzeW5jU3RvcmFnZTxNLCBUIGV4dGVuZHMgSVN0b3JhZ2VCYWNrZW5kPE0+PiB7XG4gIHJlYWRvbmx5IGV4dDogRXh0ZW5zaW9uVHlwZTxUPjtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9iYWNrZW5kOiBUO1xuICBwcml2YXRlIHJlYWRvbmx5IF9jb25maWc6IEZhY3RvcnlPcHRpb25zO1xuICBwcml2YXRlIHJlYWRvbmx5IGxvZzogKGFjdGlvbjogTG9nZ2VyQWN0aW9uKSA9PiB2b2lkO1xuICBwcml2YXRlIHJlYWRvbmx5IGVycm9yOiAoZTogRXJyb3IgfCBzdHJpbmcpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3Ioc3RvcmFnZUJhY2tlbmQ6IFQsIGFzT3B0aW9uczogRmFjdG9yeU9wdGlvbnMpIHtcbiAgICB0aGlzLl9iYWNrZW5kID0gc3RvcmFnZUJhY2tlbmQ7XG4gICAgdGhpcy5fY29uZmlnID0gYXNPcHRpb25zO1xuXG4gICAgLy8gb2ZmIGJ5IGRlZmF1bHRcbiAgICB0aGlzLmxvZyA9IG5vb3A7XG4gICAgdGhpcy5lcnJvciA9IG5vb3A7XG5cbiAgICB0aGlzLmV4dCA9IGNyZWF0ZUV4dGVuc2lvbjxUPih0aGlzLl9iYWNrZW5kKTtcblxuICAgIGlmICh0aGlzLl9jb25maWcubG9nZ2VyKSB7XG4gICAgICB0aGlzLmxvZyA9XG4gICAgICAgIHR5cGVvZiB0aGlzLl9jb25maWcubG9nZ2VyID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgPyB0aGlzLl9jb25maWcubG9nZ2VyXG4gICAgICAgICAgOiBzaW1wbGVMb2dnZXI7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX2NvbmZpZy5lcnJvckhhbmRsZXIpIHtcbiAgICAgIHRoaXMuZXJyb3IgPVxuICAgICAgICB0eXBlb2YgdGhpcy5fY29uZmlnLmVycm9ySGFuZGxlciA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgID8gdGhpcy5fY29uZmlnLmVycm9ySGFuZGxlclxuICAgICAgICAgIDogc2ltcGxlRXJyb3JIYW5kbGVyO1xuICAgIH1cbiAgfVxuICBhc3luYyBnZXRJdGVtPEsgZXh0ZW5kcyBrZXlvZiBNPihcbiAgICBrZXk6IEssXG4gICAgb3B0czogU3RvcmFnZU9wdGlvbnMgPSBudWxsLFxuICApOiBQcm9taXNlPE1bS10gfCBudWxsPiB7XG4gICAgbGV0IHZhbHVlID0gbnVsbCBhcyBNW0tdIHwgbnVsbDtcbiAgICB0cnkge1xuICAgICAgdGhpcy5sb2coe1xuICAgICAgICBhY3Rpb246ICdyZWFkLXNpbmdsZScsXG4gICAgICAgIGtleToga2V5IGFzIHN0cmluZyxcbiAgICAgIH0pO1xuICAgICAgdmFsdWUgPSBhd2FpdCB0aGlzLl9iYWNrZW5kLmdldFNpbmdsZShrZXksIG9wdHMpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRoaXMuZXJyb3IoZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgYXN5bmMgc2V0SXRlbTxLIGV4dGVuZHMga2V5b2YgTT4oXG4gICAga2V5OiBLLFxuICAgIHZhbHVlOiBNW0tdLFxuICAgIG9wdHM6IFN0b3JhZ2VPcHRpb25zID0gbnVsbCxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMubG9nKHtcbiAgICAgICAgYWN0aW9uOiAnc2F2ZS1zaW5nbGUnLFxuICAgICAgICBrZXk6IGtleSBhcyBzdHJpbmcsXG4gICAgICAgIHZhbHVlLFxuICAgICAgfSk7XG4gICAgICBhd2FpdCB0aGlzLl9iYWNrZW5kLnNldFNpbmdsZShrZXksIHZhbHVlLCBvcHRzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLmVycm9yKGUpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldE11bHRpcGxlPEsgZXh0ZW5kcyBrZXlvZiBNPihcbiAgICBrZXlzOiBBcnJheTxLPixcbiAgICBvcHRzOiBTdG9yYWdlT3B0aW9ucyA9IG51bGwsXG4gICk6IFByb21pc2U8e1trIGluIEtdOiBNW2tdIHwgbnVsbH0+IHtcbiAgICBsZXQgdmFsdWVzID0ge30gYXMge1trIGluIEtdOiBNW2tdIHwgbnVsbH07XG5cbiAgICB0cnkge1xuICAgICAgdGhpcy5sb2coe1xuICAgICAgICBhY3Rpb246ICdyZWFkLW1hbnknLFxuICAgICAgICBrZXk6IGtleXMgYXMgc3RyaW5nW10sXG4gICAgICB9KTtcbiAgICAgIHZhbHVlcyA9IGF3YWl0IHRoaXMuX2JhY2tlbmQuZ2V0TWFueShrZXlzLCBvcHRzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLmVycm9yKGUpO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZXM7XG4gIH1cblxuICBhc3luYyBzZXRNdWx0aXBsZTxLIGV4dGVuZHMga2V5b2YgTT4oXG4gICAga2V5VmFsdWVzOiBBcnJheTx7W2sgaW4gS106IE1ba119PixcbiAgICBvcHRzOiBTdG9yYWdlT3B0aW9ucyA9IG51bGwsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmxvZyh7XG4gICAgICAgIGFjdGlvbjogJ3NhdmUtbWFueScsXG4gICAgICAgIHZhbHVlOiBrZXlWYWx1ZXMsXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IHRoaXMuX2JhY2tlbmQuc2V0TWFueShrZXlWYWx1ZXMsIG9wdHMpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRoaXMuZXJyb3IoZSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVtb3ZlKGtleToga2V5b2YgTSwgb3B0czogU3RvcmFnZU9wdGlvbnMgPSBudWxsKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMubG9nKHtcbiAgICAgICAgYWN0aW9uOiAnZGVsZXRlLXNpbmdsZScsXG4gICAgICAgIGtleToga2V5IGFzIHN0cmluZyxcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgdGhpcy5fYmFja2VuZC5yZW1vdmVTaW5nbGUoa2V5LCBvcHRzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLmVycm9yKGUpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHJlbW92ZU11bHRpcGxlKFxuICAgIGtleXM6IEFycmF5PGtleW9mIE0+LFxuICAgIG9wdHM6IFN0b3JhZ2VPcHRpb25zID0gbnVsbCxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMubG9nKHtcbiAgICAgICAgYWN0aW9uOiAnZGVsZXRlLW1hbnknLFxuICAgICAgICBrZXk6IGtleXMgYXMgc3RyaW5nW10sXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IHRoaXMuX2JhY2tlbmQucmVtb3ZlTWFueShrZXlzLCBvcHRzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLmVycm9yKGUpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldEtleXMob3B0czogU3RvcmFnZU9wdGlvbnMgPSBudWxsKTogUHJvbWlzZTxBcnJheTxrZXlvZiBNPj4ge1xuICAgIGxldCBrZXlzOiBBcnJheTxrZXlvZiBNPiA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMubG9nKHtcbiAgICAgICAgYWN0aW9uOiAna2V5cycsXG4gICAgICB9KTtcbiAgICAgIGtleXMgPSBhd2FpdCB0aGlzLl9iYWNrZW5kLmdldEtleXMob3B0cyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhpcy5lcnJvcihlKTtcbiAgICB9XG5cbiAgICByZXR1cm4ga2V5cztcbiAgfVxuXG4gIGFzeW5jIGNsZWFyU3RvcmFnZShvcHRzOiBTdG9yYWdlT3B0aW9ucyA9IG51bGwpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5sb2coe1xuICAgICAgICBhY3Rpb246ICdkcm9wJyxcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgdGhpcy5fYmFja2VuZC5kcm9wU3RvcmFnZShvcHRzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLmVycm9yKGUpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBc3luY1N0b3JhZ2U7XG4iXX0=